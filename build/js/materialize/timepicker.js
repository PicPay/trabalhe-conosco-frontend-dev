"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),_get=function t(i,e,s){null===i&&(i=Function.prototype);var n=Object.getOwnPropertyDescriptor(i,e);if(void 0===n){var o=Object.getPrototypeOf(i);return null===o?void 0:t(o,e,s)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(s)};!function(t){var i={dialRadius:135,outerRadius:105,innerRadius:70,tickRadius:20,duration:350,container:null,defaultTime:"now",fromNow:0,showClearBtn:!1,i18n:{cancel:"Cancel",clear:"Clear",done:"Ok"},autoClose:!1,twelveHour:!0,vibrate:!0},e=function(e){function s(i,e){_classCallCheck(this,s);var n=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,s,i,e));return n.el.M_Timepicker=n,n.options=t.extend({},s.defaults,e),n.id=M.guid(),n._insertHTMLIntoDOM(),n._setupModal(),n._setupVariables(),n._setupEventHandlers(),n._clockSetup(),n._pickerSetup(),n}return _inherits(s,e),_createClass(s,[{key:"destroy",value:function(){this._removeEventHandlers(),this.modal.destroy(),t(this.modalEl).remove(),this.el.M_Timepicker=void 0}},{key:"_setupEventHandlers",value:function(){this._handleInputKeydownBound=this._handleInputKeydown.bind(this),this._handleInputClickBound=this._handleInputClick.bind(this),this._handleClockClickStartBound=this._handleClockClickStart.bind(this),this._handleDocumentClickMoveBound=this._handleDocumentClickMove.bind(this),this._handleDocumentClickEndBound=this._handleDocumentClickEnd.bind(this),this.el.addEventListener("click",this._handleInputClickBound),this.el.addEventListener("keydown",this._handleInputKeydownBound),this.plate.addEventListener("mousedown",this._handleClockClickStartBound),this.plate.addEventListener("touchstart",this._handleClockClickStartBound),t(this.spanHours).on("click",this.showView.bind(this,"hours")),t(this.spanMinutes).on("click",this.showView.bind(this,"minutes"))}},{key:"_removeEventHandlers",value:function(){this.el.removeEventListener("click",this._handleInputClickBound),this.el.removeEventListener("keydown",this._handleInputKeydownBound)}},{key:"_handleInputClick",value:function(){this.open()}},{key:"_handleInputKeydown",value:function(t){t.which===M.keys.ENTER&&(t.preventDefault(),this.open())}},{key:"_handleClockClickStart",value:function(t){t.preventDefault();var i=this.plate.getBoundingClientRect(),e={x:i.left,y:i.top};this.x0=e.x+this.options.dialRadius,this.y0=e.y+this.options.dialRadius,this.moved=!1;var n=s._Pos(t);this.dx=n.x-this.x0,this.dy=n.y-this.y0,this.setHand(this.dx,this.dy,!1),document.addEventListener("mousemove",this._handleDocumentClickMoveBound),document.addEventListener("touchmove",this._handleDocumentClickMoveBound),document.addEventListener("mouseup",this._handleDocumentClickEndBound),document.addEventListener("touchend",this._handleDocumentClickEndBound)}},{key:"_handleDocumentClickMove",value:function(t){t.preventDefault();var i=s._Pos(t),e=i.x-this.x0,n=i.y-this.y0;this.moved=!0,this.setHand(e,n,!1,!0)}},{key:"_handleDocumentClickEnd",value:function(i){var e=this;i.preventDefault(),document.removeEventListener("mouseup",this._handleDocumentClickEndBound),document.removeEventListener("touchend",this._handleDocumentClickEndBound);var n=s._Pos(i),o=n.x-this.x0,a=n.y-this.y0;this.moved&&o===this.dx&&a===this.dy&&this.setHand(o,a),"hours"===this.currentView?this.showView("minutes",this.options.duration/2):this.options.autoClose&&(t(this.minutesView).addClass("timepicker-dial-out"),setTimeout(function(){e.done()},this.options.duration/2)),document.removeEventListener("mousemove",this._handleDocumentClickMoveBound),document.removeEventListener("touchmove",this._handleDocumentClickMoveBound)}},{key:"_insertHTMLIntoDOM",value:function(){this.$modalEl=t(s._template),this.modalEl=this.$modalEl[0],this.modalEl.id="modal-"+this.id;var i=document.querySelector(this.options.container);this.options.container&&i?this.$modalEl.appendTo(i):this.$modalEl.insertBefore(this.el)}},{key:"_setupModal",value:function(){var t=this;this.modal=M.Modal.init(this.modalEl,{onCloseEnd:function(){t.isOpen=!1}})}},{key:"_setupVariables",value:function(){this.currentView="hours",this.vibrate=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,this._canvas=this.modalEl.querySelector(".timepicker-canvas"),this.plate=this.modalEl.querySelector(".timepicker-plate"),this.hoursView=this.modalEl.querySelector(".timepicker-hours"),this.minutesView=this.modalEl.querySelector(".timepicker-minutes"),this.spanHours=this.modalEl.querySelector(".timepicker-span-hours"),this.spanMinutes=this.modalEl.querySelector(".timepicker-span-minutes"),this.spanAmPm=this.modalEl.querySelector(".timepicker-span-am-pm"),this.footer=this.modalEl.querySelector(".timepicker-footer"),this.amOrPm="PM"}},{key:"_pickerSetup",value:function(){var i=t('<button class="btn-flat timepicker-clear waves-effect" style="visibility: hidden;" type="button" tabindex="'+(this.options.twelveHour?"3":"1")+'">'+this.options.i18n.clear+"</button>").appendTo(this.footer).on("click",this.clear.bind(this));this.options.showClearBtn&&i.css({visibility:""});var e=t('<div class="confirmation-btns"></div>');t('<button class="btn-flat timepicker-close waves-effect" type="button" tabindex="'+(this.options.twelveHour?"3":"1")+'">'+this.options.i18n.cancel+"</button>").appendTo(e).on("click",this.close.bind(this)),t('<button class="btn-flat timepicker-close waves-effect" type="button" tabindex="'+(this.options.twelveHour?"3":"1")+'">'+this.options.i18n.done+"</button>").appendTo(e).on("click",this.done.bind(this)),e.appendTo(this.footer)}},{key:"_clockSetup",value:function(){this.options.twelveHour&&(this.$amBtn=t('<div class="am-btn">AM</div>'),this.$pmBtn=t('<div class="pm-btn">PM</div>'),this.$amBtn.on("click",this._handleAmPmClick.bind(this)).appendTo(this.spanAmPm),this.$pmBtn.on("click",this._handleAmPmClick.bind(this)).appendTo(this.spanAmPm)),this._buildHoursView(),this._buildMinutesView(),this._buildSVGClock()}},{key:"_buildSVGClock",value:function(){var t=this.options.dialRadius,i=this.options.tickRadius,e=2*t,n=s._createSVGEl("svg");n.setAttribute("class","timepicker-svg"),n.setAttribute("width",e),n.setAttribute("height",e);var o=s._createSVGEl("g");o.setAttribute("transform","translate("+t+","+t+")");var a=s._createSVGEl("circle");a.setAttribute("class","timepicker-canvas-bearing"),a.setAttribute("cx",0),a.setAttribute("cy",0),a.setAttribute("r",4);var r=s._createSVGEl("line");r.setAttribute("x1",0),r.setAttribute("y1",0);var l=s._createSVGEl("circle");l.setAttribute("class","timepicker-canvas-bg"),l.setAttribute("r",i),o.appendChild(r),o.appendChild(l),o.appendChild(a),n.appendChild(o),this._canvas.appendChild(n),this.hand=r,this.bg=l,this.bearing=a,this.g=o}},{key:"_buildHoursView",value:function(){var i=t('<div class="timepicker-tick"></div>');if(this.options.twelveHour)for(var e=1;e<13;e+=1){var s=i.clone(),n=e/6*Math.PI,o=this.options.outerRadius;s.css({left:this.options.dialRadius+Math.sin(n)*o-this.options.tickRadius+"px",top:this.options.dialRadius-Math.cos(n)*o-this.options.tickRadius+"px"}),s.html(0===e?"00":e),this.hoursView.appendChild(s[0])}else for(var a=0;a<24;a+=1){var r=i.clone(),l=a/6*Math.PI,u=a>0&&a<13,h=u?this.options.innerRadius:this.options.outerRadius;r.css({left:this.options.dialRadius+Math.sin(l)*h-this.options.tickRadius+"px",top:this.options.dialRadius-Math.cos(l)*h-this.options.tickRadius+"px"}),r.html(0===a?"00":a),this.hoursView.appendChild(r[0])}}},{key:"_buildMinutesView",value:function(){for(var i=t('<div class="timepicker-tick"></div>'),e=0;e<60;e+=5){var n=i.clone(),o=e/30*Math.PI;n.css({left:this.options.dialRadius+Math.sin(o)*this.options.outerRadius-this.options.tickRadius+"px",top:this.options.dialRadius-Math.cos(o)*this.options.outerRadius-this.options.tickRadius+"px"}),n.html(s._addLeadingZero(e)),this.minutesView.appendChild(n[0])}}},{key:"_handleAmPmClick",value:function(i){var e=t(i.target);this.amOrPm=e.hasClass("am-btn")?"AM":"PM",this._updateAmPmView()}},{key:"_updateAmPmView",value:function(){this.options.twelveHour&&(this.$amBtn.toggleClass("text-primary","AM"===this.amOrPm),this.$pmBtn.toggleClass("text-primary","PM"===this.amOrPm))}},{key:"_updateTimeFromInput",value:function(){var t=((this.el.value||this.options.defaultTime||"")+"").split(":");if(this.options.twelveHour&&void 0!==t[1]&&(t[1].toUpperCase().indexOf("AM")>0?this.amOrPm="AM":this.amOrPm="PM",t[1]=t[1].replace("AM","").replace("PM","")),"now"===t[0]){var i=new Date(+new Date+this.options.fromNow);t=[i.getHours(),i.getMinutes()],this.options.twelveHour&&(this.amOrPm=t[0]>=12&&t[0]<24?"PM":"AM")}this.hours=+t[0]||0,this.minutes=+t[1]||0,this.spanHours.innerHTML=this.hours,this.spanMinutes.innerHTML=s._addLeadingZero(this.minutes),this._updateAmPmView()}},{key:"showView",value:function(i,e){"minutes"===i&&t(this.hoursView).css("visibility");var s="hours"===i,n=s?this.hoursView:this.minutesView,o=s?this.minutesView:this.hoursView;this.currentView=i,t(this.spanHours).toggleClass("text-primary",s),t(this.spanMinutes).toggleClass("text-primary",!s),o.classList.add("timepicker-dial-out"),t(n).css("visibility","visible").removeClass("timepicker-dial-out"),this.resetClock(e),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){t(o).css("visibility","hidden")},this.options.duration)}},{key:"resetClock",value:function(i){var e=this.currentView,s=this[e],n="hours"===e,o=Math.PI/(n?6:30),a=s*o,r=n&&s>0&&s<13?this.options.innerRadius:this.options.outerRadius,l=Math.sin(a)*r,u=-Math.cos(a)*r,h=this;i?(t(this.canvas).addClass("timepicker-canvas-out"),setTimeout(function(){t(h.canvas).removeClass("timepicker-canvas-out"),h.setHand(l,u)},i)):this.setHand(l,u)}},{key:"setHand",value:function(t,i,e){var n=this,o=Math.atan2(t,-i),a="hours"===this.currentView,r=Math.PI/(a||e?6:30),l=Math.sqrt(t*t+i*i),u=a&&l<(this.options.outerRadius+this.options.innerRadius)/2,h=u?this.options.innerRadius:this.options.outerRadius;this.options.twelveHour&&(h=this.options.outerRadius),o<0&&(o=2*Math.PI+o);var c=Math.round(o/r);o=c*r,this.options.twelveHour?a?0===c&&(c=12):(e&&(c*=5),60===c&&(c=0)):a?(12===c&&(c=0),c=u?0===c?12:c:0===c?0:c+12):(e&&(c*=5),60===c&&(c=0)),this[this.currentView]!==c&&this.vibrate&&this.options.vibrate&&(this.vibrateTimer||(navigator[this.vibrate](10),this.vibrateTimer=setTimeout(function(){n.vibrateTimer=null},100))),this[this.currentView]=c,a?this.spanHours.innerHTML=c:this.spanMinutes.innerHTML=s._addLeadingZero(c);var d=Math.sin(o)*(h-this.options.tickRadius),p=-Math.cos(o)*(h-this.options.tickRadius),m=Math.sin(o)*h,v=-Math.cos(o)*h;this.hand.setAttribute("x2",d),this.hand.setAttribute("y2",p),this.bg.setAttribute("cx",m),this.bg.setAttribute("cy",v)}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this._updateTimeFromInput(),this.showView("hours"),this.modal.open())}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.modal.close())}},{key:"done",value:function(t,i){var e=this.el.value,n=i?"":s._addLeadingZero(this.hours)+":"+s._addLeadingZero(this.minutes);this.time=n,!i&&this.options.twelveHour&&(n=n+" "+this.amOrPm),this.el.value=n,n!==e&&this.$el.trigger("change"),this.close(),this.el.focus()}},{key:"clear",value:function(){this.done(null,!0)}}],[{key:"init",value:function(t,i){return _get(s.__proto__||Object.getPrototypeOf(s),"init",this).call(this,this,t,i)}},{key:"_addLeadingZero",value:function(t){return(t<10?"0":"")+t}},{key:"_createSVGEl",value:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}},{key:"_Pos",value:function(t){return t.targetTouches&&t.targetTouches.length>=1?{x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY}:{x:t.clientX,y:t.clientY}}},{key:"getInstance",value:function(t){return(t.jquery?t[0]:t).M_Timepicker}},{key:"defaults",get:function(){return i}}]),s}(Component);e._template=['<div class= "modal timepicker-modal">','<div class="modal-content timepicker-container">','<div class="timepicker-digital-display">','<div class="timepicker-text-container">','<div class="timepicker-display-column">','<span class="timepicker-span-hours text-primary"></span>',":",'<span class="timepicker-span-minutes"></span>',"</div>",'<div class="timepicker-display-column timepicker-display-am-pm">','<div class="timepicker-span-am-pm"></div>',"</div>","</div>","</div>",'<div class="timepicker-analog-display">','<div class="timepicker-plate">','<div class="timepicker-canvas"></div>','<div class="timepicker-dial timepicker-hours"></div>','<div class="timepicker-dial timepicker-minutes timepicker-dial-out"></div>',"</div>",'<div class="timepicker-footer"></div>',"</div>","</div>","</div>"].join(""),M.Timepicker=e,M.jQueryLoaded&&M.initializeJqueryWrapper(e,"timepicker","M_Timepicker")}(cash);